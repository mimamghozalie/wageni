(()=>{"use strict";var __webpack_modules__={102:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),app_service_1=__webpack_require__(1);let AppController=class AppController{constructor(appService){this.appService=appService}getData(){return this.appService.getData()}};tslib_1.__decorate([(0,common_1.Get)(),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[]),tslib_1.__metadata("design:returntype",void 0)],AppController.prototype,"getData",null),AppController=tslib_1.__decorate([(0,common_1.Controller)(),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==app_service_1.AppService&&app_service_1.AppService)?_a:Object])],AppController),exports.AppController=AppController},358:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),app_controller_1=__webpack_require__(102),app_service_1=__webpack_require__(1),instance_module_1=__webpack_require__(221);let AppModule=class AppModule{};AppModule=tslib_1.__decorate([(0,common_1.Module)({imports:[instance_module_1.InstanceModule],controllers:[app_controller_1.AppController],providers:[app_service_1.AppService]})],AppModule),exports.AppModule=AppModule},1:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481);let AppService=class AppService{getData(){return{message:"Welcome to wa-service!"}}};AppService=tslib_1.__decorate([(0,common_1.Injectable)()],AppService),exports.AppService=AppService},751:(__unused_webpack_module,exports,__webpack_require__)=>{var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstanceController=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),instance_services_1=__webpack_require__(74);let InstanceController=class InstanceController{constructor(instanceService){this.instanceService=instanceService}createInstance(id){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.instanceService.createInstance(id)}))}sendMessage(body,instanceID){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.instanceService.sendMessage(instanceID,body)}))}qr(instanceID){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return this.instanceService.getQrCode(instanceID)}))}};tslib_1.__decorate([(0,common_1.Post)("create"),tslib_1.__param(0,(0,common_1.Body)("instanceID")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",Promise)],InstanceController.prototype,"createInstance",null),tslib_1.__decorate([(0,common_1.Post)(":instanceID/message"),tslib_1.__param(0,(0,common_1.Body)()),tslib_1.__param(1,(0,common_1.Param)("instanceID")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[Object,String]),tslib_1.__metadata("design:returntype",Promise)],InstanceController.prototype,"sendMessage",null),tslib_1.__decorate([(0,common_1.Get)(":instanceID/qr"),tslib_1.__param(0,(0,common_1.Param)("instanceID")),tslib_1.__metadata("design:type",Function),tslib_1.__metadata("design:paramtypes",[String]),tslib_1.__metadata("design:returntype",Promise)],InstanceController.prototype,"qr",null),InstanceController=tslib_1.__decorate([(0,common_1.Controller)("instance"),tslib_1.__metadata("design:paramtypes",["function"==typeof(_a=void 0!==instance_services_1.InstanceService&&instance_services_1.InstanceService)?_a:Object])],InstanceController),exports.InstanceController=InstanceController},221:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstanceModule=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),instance_controller_1=__webpack_require__(751),instance_services_1=__webpack_require__(74);let InstanceModule=class InstanceModule{};InstanceModule=tslib_1.__decorate([(0,common_1.Module)({controllers:[instance_controller_1.InstanceController],providers:[instance_services_1.InstanceService]})],InstanceModule),exports.InstanceModule=InstanceModule},74:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstanceService=void 0;const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),whatsapp_web_js_1=__webpack_require__(55);let InstanceService=class InstanceService{constructor(){this.logger=new common_1.Logger("Instance"),this.INSTANCES=[]}createInstance(instanceID){return tslib_1.__awaiter(this,void 0,void 0,(function*(){if(-1!==this.INSTANCES.findIndex((i=>i.instanceID==instanceID)))throw new common_1.BadRequestException("Instance already created!");return this.INSTANCES.push({instanceID,instance:null}),yield this.addInstance(instanceID),{message:`Instance ${instanceID} Created`}}))}addInstance(instanceID){this.logger.log(`[${instanceID}] is Creating`);const instance=new whatsapp_web_js_1.Client({authStrategy:new whatsapp_web_js_1.LocalAuth({clientId:instanceID}),puppeteer:{executablePath:process.env.CHROME_BIN,args:["--no-sandbox","--headless"]},qrMaxRetries:10});return instance.on("qr",(qr=>{this.logger.log(`[${instanceID}] Got QR Code`);const instanceIndex=this.INSTANCES.findIndex((i=>i.instanceID==instanceID));-1==instanceIndex&&this.logger.error(`[QR] Instance ${instanceID} not Found`),this.INSTANCES[instanceIndex].qr=qr})),instance.on("ready",(()=>tslib_1.__awaiter(this,void 0,void 0,(function*(){this.logger.log(`[${instanceID}] is Ready`);const instanceIndex=this.INSTANCES.findIndex((i=>i.instanceID==instanceID));-1==instanceIndex&&this.logger.error(`Instance ${instanceID} not Found`),this.INSTANCES[instanceIndex].instance=instance,this.INSTANCES[instanceIndex].qr="READY",this.logger.log(`[${instanceID}] SAVED to Global Instances`)})))),instance.initialize(),instance}getQrCode(instanceID){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const instace=this.INSTANCES.filter((i=>i.instanceID===instanceID));if(0==instace.length)throw new common_1.BadRequestException("Instance not found!");return{qr:instace[0].qr}}))}getInstace(instanceID){const instace=this.INSTANCES.filter((i=>i.instanceID===instanceID));if(0!=instace.length)return instace[0].instance}destroyInstance(instanceID){return tslib_1.__awaiter(this,void 0,void 0,(function*(){try{return yield this.addInstance(instanceID).destroy(),{message:`Instance ${instanceID} has Destroyed!`}}catch(error){throw new common_1.BadRequestException}}))}sendMessage(instanceID,message){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const instance=this.getInstace(instanceID);if(null==instance)throw new common_1.BadRequestException("Instance not found!");if("CONNECTED"==(yield instance.getState())){const phone=yield instance.getNumberId(message.phone);return yield instance.sendMessage(phone._serialized,message.body)}throw new common_1.BadRequestException("Instance not Connected!")}))}};InstanceService=tslib_1.__decorate([(0,common_1.Injectable)()],InstanceService),exports.InstanceService=InstanceService},321:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.environment=void 0,exports.environment={production:!0}},481:module=>{module.exports=require("@nestjs/common")},143:module=>{module.exports=require("@nestjs/core")},806:module=>{module.exports=require("helmet")},752:module=>{module.exports=require("tslib")},55:module=>{module.exports=require("whatsapp-web.js")}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}var __webpack_exports__={};(()=>{var exports=__webpack_exports__;Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__(752),common_1=__webpack_require__(481),core_1=__webpack_require__(143),helmet=__webpack_require__(806),app_module_1=__webpack_require__(358),environment_1=__webpack_require__(321);!function(){tslib_1.__awaiter(this,void 0,void 0,(function*(){const app=yield core_1.NestFactory.create(app_module_1.AppModule,{logger:environment_1.environment.production?["error","warn"]:["log","debug","warn","error"]});app.use(helmet.default()),app.useGlobalPipes(new common_1.ValidationPipe({whitelist:!0,disableErrorMessages:environment_1.environment.production,transform:!0}));const port=process.env.PORT||3333;yield app.listen(port),console.log(`Application is running at PORT: ${port}`)}))}()})();var __webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();